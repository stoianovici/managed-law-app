# Epic 4: Output Generation & Conversion

**Goal**: Implement summary screen with professional output design, build PDF generation system (shareable reports), create email capture and delivery flow, integrate calendar booking (Cal.com/Calendly), and generate structured discovery documents for vendor follow-up. This epic completes the end-to-end wizard experience from entry to conversion.

## Story 4.1: Professional Summary Screen

As a **wizard user**,
I want **a comprehensive summary showing all my selections and recommendations**,
so that **I can review everything before proceeding to download or book a call**.

### Acceptance Criteria

1. Summary screen displays after user clicks "Continue to Summary" from pricing panel
2. Summary sections organized clearly:
   - "Your Business Context" (industry, team size, pain points, volume metrics)
   - "Recommended Automations" (list of selected automations with descriptions)
   - "Time Savings Analysis" (total hours saved per week/month, breakdown by automation)
   - "Investment Summary" (total monthly cost, cost per hour saved, ROI calculation)
3. Each automation in summary shows: icon, title, description, time savings, individual cost
4. Visual design is professional and boardroom-ready (clean typography, good spacing, minimal clutter)
5. "Problems Identified" section summarizes user's pain points with context (e.g., "50 contracts/week consuming 15 hours of paralegal time")
6. "Proposed Solutions" section explains how each automation addresses specific pain points
7. Summary includes contextual insights generated by AI (carried forward from earlier screens)
8. "Edit Package" button navigates back to workflow sketcher (preserves all selections)
9. Two primary CTAs prominently displayed:
   - "Get PDF Report" (triggers email capture flow)
   - "Book a Consultation" (triggers calendar booking flow)
10. Summary data persisted to `discovery_documents` table with status updated to "completed"
11. Print-friendly CSS applied (optimized for printing or PDF conversion)
12. Responsive design: summary displays cleanly on mobile and desktop
13. Analytics tracking: summary view event, time spent on summary, which CTA clicked
14. Summary includes timestamp: "Report generated: [date/time]"

## Story 4.2: PDF Generation System

As a **wizard user**,
I want **to download a professional PDF report of my automation plan**,
so that **I can share it with partners, stakeholders, or review it later offline**.

### Acceptance Criteria

1. PDF generation service created using Puppeteer or React-PDF library
2. PDF template designed matching summary screen content with professional branding:
   - Cover page with wizard branding, user's business name, report date
   - Business context section (industry, team, pain points)
   - Automation recommendations with descriptions, time savings, costs
   - Visual charts/graphs showing time savings breakdown (optional for MVP)
   - Investment summary with ROI calculations
   - Next steps section with contact information and booking link
3. PDF generation completes within 5 seconds of user request
4. PDF file size optimized (<2MB for easy email transmission)
5. PDF filename formatted clearly: "AI-Automation-Plan-{Industry}-{Date}.pdf"
6. PDF generation handles edge cases: long descriptions, many automations (pagination works correctly)
7. PDF stored temporarily on server (24 hours) for email delivery, then auto-deleted
8. API endpoint created: POST `/api/pdf/generate` accepts session_id, returns PDF URL or binary
9. Error handling: if PDF generation fails, show user-friendly error with retry option
10. Unit tests mock PDF generation to validate data formatting
11. Integration tests verify actual PDF generation with sample data
12. PDF includes footer with wizard URL and disclaimer: "Estimates are approximate and subject to final scoping"
13. PDF is accessible: proper heading structure, readable fonts, high contrast

## Story 4.3: Email Capture & PDF Delivery

As a **wizard user**,
I want **to receive the PDF report via email**,
so that **I have a permanent copy and can access it from anywhere**.

### Acceptance Criteria

1. Email capture modal displays when user clicks "Get PDF Report"
2. Modal displays value proposition: "Receive your personalized AI automation plan as a shareable PDF"
3. Email input field with validation (proper email format required)
4. Privacy assurance displayed: "We'll only use your email to send this report and occasional updates. No spam."
5. Checkbox: "Subscribe to automation insights newsletter" (opt-in, not required for PDF)
6. "Send Report" button triggers PDF generation and email delivery
7. Email service integrated (Resend, SendGrid, or Postmark)
8. Transactional email template created:
   - Subject: "Your AI Automation Plan for [Industry]"
   - Body: Personalized greeting, summary of recommendations, PDF attachment, CTA to book consultation
   - Footer: Unsubscribe link, company contact information
9. PDF attached to email (or link to download if attachment too large)
10. Email delivery completes within 30 seconds of user submission
11. Confirmation screen displayed after email sent: "Report sent to {email}! Check your inbox."
12. Email address stored in `discovery_documents` table for follow-up
13. Error handling: if email fails to send, display error and offer retry or direct PDF download
14. Analytics tracking: email capture rate, delivery success rate
15. Email open tracking and link click tracking (optional, privacy-friendly)
16. Unsubscribe mechanism implemented for users who opted into newsletter

## Story 4.4: Calendar Booking Integration

As a **wizard user**,
I want **to easily schedule a consultation with pre-filled context**,
so that **I can discuss my automation plan without repeating information**.

### Acceptance Criteria

1. Calendar booking integration selected and configured (Cal.com or Calendly)
2. "Book a Consultation" button triggers calendar booking flow
3. Calendar booking opens in modal/iframe or new tab (user preference)
4. Meeting agenda pre-filled based on discovery data:
   - Meeting title: "AI Automation Consultation - [Industry]"
   - Description includes: Business context, selected automations, estimated cost, time savings
   - Example: "Discuss contract review automation for real estate closings. Package: 5 automations, $2,450/month, 42 hours/month saved."
5. Calendar integration passes session metadata to booking system (session_id or discovery_document_id)
6. Booking confirmation creates record in database linking session to scheduled meeting
7. Booking confirmation email includes PDF report attachment (if user provided email earlier)
8. If user hasn't provided email yet, email capture triggered after booking confirmed
9. Calendar displays vendor's available time slots (15-30 min consultation slots)
10. User receives booking confirmation email with calendar invite (handled by calendar service)
11. Vendor receives notification of new booking with discovery document reference
12. Analytics tracking: booking completion rate, booking source (summary screen vs email link)
13. Error handling: if calendar unavailable, show fallback contact form or email CTA
14. Mobile-optimized: calendar booking works smoothly on mobile devices

## Story 4.5: Discovery Document Generation (Vendor View)

As a **vendor/sales team member**,
I want **structured discovery documents for each completed wizard session**,
so that **I can prepare effectively for consultations and follow up with qualified leads**.

### Acceptance Criteria

1. Discovery document format designed capturing all session data:
   - Contact information (email if provided)
   - Business context (industry, team size, pain points, volume metrics)
   - Full question/answer history with timestamps
   - AI-generated recommendations (original and user-modified)
   - Final automation package with pricing breakdown
   - Time savings analysis and ROI calculations
   - Session metadata (duration, completion date, device type, abandonment points if incomplete)
   - Lead quality indicators (package value, engagement level, booking status)
2. Discovery documents stored in `discovery_documents` table with status: "completed", "booked", "emailed"
3. API endpoint created: GET `/api/discovery-documents` returns list of documents (vendor access only, requires authentication placeholder for MVP)
4. Simple admin view/dashboard displays discovery documents in table:
   - Columns: Date, Industry, Team Size, Automations Count, Total Cost, Status (Completed/Booked/Emailed)
   - Sortable by date, cost, status
   - Click row to view full discovery document details
5. Discovery document detail view displays all captured information in organized sections
6. Export discovery document as JSON or CSV for CRM import (optional for MVP)
7. Discovery documents retained for 90 days, then auto-deleted for privacy compliance
8. Lead quality score calculated based on: package value, time spent in wizard, booking completion
9. Analytics dashboard shows: total completions, conversion rates, average package value, top industries
10. Email notification sent to vendor when high-value lead (>$2,000/month) completes wizard or books call
11. Discovery documents redact sensitive information if user didn't opt in to contact
12. Admin authentication placeholder: basic password protection or IP whitelist for MVP (proper auth post-MVP)
