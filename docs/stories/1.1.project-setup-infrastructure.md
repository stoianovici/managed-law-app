# Story 1.1: Project Setup & Infrastructure

## Status

In Progress

## Story

**As a** developer,
**I want** a fully configured monorepo with CI/CD pipeline,
**so that** the team can develop, test, and deploy code efficiently from day one.

## Acceptance Criteria

1. Monorepo structure created with `/frontend`, `/backend`, `/shared`, `/docs` folders using npm/pnpm workspaces
2. TypeScript configured across all packages with shared tsconfig.json
3. ESLint + Prettier configured with consistent rules enforced via pre-commit hooks (Husky)
4. GitHub repository created with main branch protection (require PR reviews, passing tests)
5. GitHub Actions CI/CD pipeline configured: runs linting, type-checking, and tests on every PR
6. Frontend deployed to Vercel or Netlify with automatic preview deployments for PRs
7. Backend deployed to Railway/Render/Fly.io with environment variables configured
8. PostgreSQL database provisioned (Supabase/Railway/Neon) with connection established
9. Redis/Upstash instance provisioned for session caching (or deferred if using Supabase)
10. Basic health check endpoint (`/api/health`) returns 200 OK when backend is running
11. Frontend displays "Hello World" page served from production deployment
12. README.md documents setup instructions, development workflow, and deployment process

## Tasks / Subtasks

- [x] Task 1: Initialize Monorepo Structure (AC: 1)
  - [x] Create project root directory `ai-discovery-wizard/`
  - [x] Initialize pnpm workspace with root `package.json` and `pnpm-workspace.yaml`
  - [x] Create folder structure: `apps/web/`, `packages/shared/`, `packages/ui/`, `packages/database/`, `docs/`, `scripts/`
  - [x] Create individual `package.json` files for each workspace with appropriate package names (`@repo/shared`, `@repo/ui`, `@repo/database`)

- [x] Task 2: Configure TypeScript (AC: 2)
  - [x] Install TypeScript 5.3+ as root devDependency
  - [x] Create root `tsconfig.json` with base configuration (strict mode, ES2022 target, module resolution)
  - [x] Create `apps/web/tsconfig.json` extending root config with Next.js-specific settings
  - [x] Create `packages/shared/tsconfig.json` for shared types
  - [x] Create `packages/database/tsconfig.json` for database schema types
  - [x] Add `type-check` script to root package.json: `pnpm --filter ./apps/web type-check && pnpm --filter ./packages/** type-check`

- [x] Task 3: Initialize Next.js 14 App in apps/web (AC: 1, 2, 11)
  - [x] Run `npx create-next-app@latest apps/web` with TypeScript, App Router, Tailwind CSS, ESLint
  - [x] Configure `next.config.js` for monorepo with `transpilePackages: ['@repo/shared', '@repo/ui']`
  - [x] Install Tailwind CSS 3.4+ and configure `tailwind.config.ts`
  - [x] Create basic landing page in `apps/web/app/page.tsx` with "Hello World" message
  - [x] Verify dev server runs: `pnpm dev` at http://localhost:3000

- [x] Task 4: Configure ESLint and Prettier (AC: 3)
  - [x] Install ESLint, Prettier, and related plugins as root devDependencies
  - [x] Create root `.eslintrc.json` extending `next/core-web-vitals` and TypeScript recommended rules
  - [x] Create root `.prettierrc` with project formatting rules (semi: true, singleQuote: true, etc.)
  - [x] Create `.prettierignore` to exclude build folders and node_modules
  - [x] Add lint and format scripts to root package.json
  - [x] Verify linting works: `pnpm lint` and `pnpm format`

- [x] Task 5: Setup Pre-commit Hooks with Husky (AC: 3)
  - [x] Install Husky and lint-staged as root devDependencies
  - [x] Initialize Husky: `npx husky install`
  - [x] Create `.husky/pre-commit` hook that runs lint-staged
  - [x] Configure lint-staged in root package.json to run ESLint and Prettier on staged files
  - [x] Test pre-commit hook by making a commit with intentional linting error (should fail)

- [x] Task 6: Setup Supabase Database (AC: 8)
  - [x] Create Supabase project via dashboard (US-East-1 region)
  - [x] Note database connection string and anon/service keys
  - [x] Create `apps/web/.env.local.example` with Supabase environment variables template
  - [x] Create `apps/web/.env.local` with actual Supabase credentials (add to .gitignore)
  - [x] Install `@supabase/supabase-js` in apps/web
  - [x] Create `apps/web/lib/supabase/client.ts` with Supabase client initialization
  - [x] Verify connection by running simple query in development

- [x] Task 7: Create Health Check API Endpoint (AC: 10)
  - [x] Create `apps/web/app/api/health/route.ts` with GET handler
  - [x] Implement health check logic: return 200 OK with `{ status: 'healthy', timestamp: Date.now() }`
  - [x] Test endpoint locally: `curl http://localhost:3000/api/health`
  - [x] Verify response matches expected format

- [ ] Task 8: Initialize Git Repository (AC: 4)
  - [ ] Create `.gitignore` with Node.js, Next.js, environment files, and IDE folders
  - [ ] Initialize git: `git init`
  - [ ] Create initial commit with project structure
  - [ ] Create GitHub repository (public or private based on preference)
  - [ ] Add remote: `git remote add origin <repo-url>`
  - [ ] Push to GitHub: `git push -u origin main`

- [ ] Task 9: Configure GitHub Branch Protection (AC: 4)
  - [ ] Navigate to GitHub repository settings → Branches
  - [ ] Add branch protection rule for `main` branch
  - [ ] Enable: "Require a pull request before merging", "Require approvals (1)"
  - [ ] Enable: "Require status checks to pass before merging"
  - [ ] Enable: "Require branches to be up to date before merging"
  - [ ] Save protection rules

- [ ] Task 10: Setup GitHub Actions CI/CD Pipeline (AC: 5)
  - [ ] Create `.github/workflows/ci.yml` file
  - [ ] Configure workflow to trigger on pull requests to main branch
  - [ ] Add CI jobs: install dependencies, run lint (`pnpm lint`), run type-check (`pnpm type-check`), run tests (`pnpm test`)
  - [ ] Commit workflow file and push to GitHub
  - [ ] Verify CI runs on next PR

- [ ] Task 11: Deploy Frontend to Vercel (AC: 6)
  - [ ] Connect GitHub repository to Vercel (import project)
  - [ ] Configure Vercel settings: Root Directory = `apps/web`, Framework Preset = Next.js, Build Command = `cd ../.. && pnpm install && pnpm --filter web build`
  - [ ] Add Supabase environment variables to Vercel project settings
  - [ ] Trigger initial deployment
  - [ ] Verify production URL displays "Hello World" page
  - [ ] Enable automatic preview deployments for pull requests in Vercel settings

- [ ] Task 12: Write README Documentation (AC: 12)
  - [ ] Create comprehensive `README.md` in project root
  - [ ] Document prerequisites (Node.js 20 LTS, pnpm)
  - [ ] Document setup instructions: clone, install, configure env, run dev server
  - [ ] Document development workflow: creating branches, running tests, making PRs
  - [ ] Document monorepo structure and package purposes
  - [ ] Document deployment process (Vercel automatic deployment)
  - [ ] Document available scripts: dev, build, test, lint, format, type-check
  - [ ] Add links to architecture documentation

- [ ] Task 13: Validation and Testing
  - [ ] Run `pnpm install` from project root (verify workspace resolution)
  - [ ] Run `pnpm type-check` (verify TypeScript compiles without errors)
  - [ ] Run `pnpm lint` (verify no linting errors)
  - [ ] Run `pnpm format --check` (verify code formatting is correct)
  - [ ] Make a test commit to verify Husky pre-commit hook executes
  - [ ] Create a test PR to verify GitHub Actions CI runs and passes
  - [ ] Verify Vercel preview deployment is created for test PR
  - [ ] Visit production Vercel URL and verify "Hello World" page loads
  - [ ] Test health check endpoint in production: `curl https://<vercel-url>/api/health`

## Dev Notes

### Project Structure

[Source: architecture/unified-project-structure.md]

The monorepo follows this exact structure:

```
ai-discovery-wizard/
├── apps/
│   └── web/                      # Next.js application
│       ├── app/                  # App Router
│       ├── components/           # React components
│       ├── lib/                  # Services, actions, utilities
│       ├── public/               # Static assets
│       └── tests/                # Tests
├── packages/
│   ├── shared/                   # Shared types & utilities
│   ├── ui/                       # Shared UI components
│   └── database/                 # Database schema & migrations
├── scripts/                      # Build and utility scripts
├── docs/                         # Documentation
└── package.json                  # Root workspace config
```

**Important**: The PRD epic mentions `/frontend`, `/backend`, `/shared` folders, but the architecture specifies `apps/web/` (Next.js combines frontend+backend). Implement according to architecture (apps/web structure), as Next.js 14 App Router serves both frontend and backend through API Routes and Server Actions.

### Technology Stack

[Source: architecture/tech-stack.md]

**Required Versions:**

- Node.js: 20 LTS
- TypeScript: 5.3+
- Next.js: 14.1+ (App Router)
- pnpm workspaces (preferred over npm for faster installs and better disk usage)
- Tailwind CSS: 3.4+

**Testing Setup (deferred to Story 1.2):**

- Vitest 1.2+ for unit/integration tests
- React Testing Library 14+ for component tests

**Key Dependencies for apps/web:**

- `next@14.1+`
- `react@18+`
- `typescript@5.3+`
- `@supabase/supabase-js` (latest)
- `tailwindcss@3.4+`

### Deployment Architecture

[Source: architecture/deployment-architecture.md]

**Hosting:**

- Frontend + Backend: Vercel (unified deployment)
- Database: Supabase (hosted PostgreSQL, US-East-1)
- File Storage: Supabase Storage (deferred to later story)

**Environments:**

- Development: http://localhost:3000
- Preview: https://ai-wizard-git-[branch].vercel.app (automatic on PR)
- Production: https://[project-name].vercel.app (automatic on merge to main)

**CI/CD Pipeline:**

- GitHub Actions runs lint, type-check, tests on every PR
- Vercel creates preview deployment for every PR
- Vercel deploys to production on merge to main

### Coding Standards

[Source: architecture/coding-standards.md]

**Critical Rules:**

- Use Server Components by default, only add `'use client'` when needed
- Define shared types in `packages/shared/src/types` and import from `@repo/shared`
- Access environment variables through config objects, never `process.env` directly
- All API routes must use standard error handler with structured responses

**Naming Conventions:**

- Components: PascalCase (e.g., `WizardShell.tsx`)
- API Routes: kebab-case (e.g., `/api/user-profile`)
- Database Tables: snake_case (e.g., `user_profiles`)
- Types/Interfaces: PascalCase (e.g., `Session`)

### Development Workflow

[Source: architecture/development-workflow.md]

**Setup Commands:**

```bash
git clone <repo>
cd ai-discovery-wizard
pnpm install
cp apps/web/.env.local.example apps/web/.env.local
# Edit .env.local with Supabase keys
pnpm dev
```

**Available Scripts:**

```bash
pnpm dev              # Start dev server
pnpm build            # Production build
pnpm test             # Run tests
pnpm lint             # ESLint
pnpm type-check       # TypeScript check
pnpm format           # Prettier formatting
```

### Supabase Configuration

[Source: architecture/tech-stack.md#database, architecture/deployment-architecture.md]

**Required Environment Variables for .env.local:**

```
NEXT_PUBLIC_SUPABASE_URL=https://[project-ref].supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=[anon-key]
SUPABASE_SERVICE_ROLE_KEY=[service-role-key]
```

**Supabase Client Setup Location:**
Create at `apps/web/lib/supabase/client.ts` following Next.js 14 App Router patterns.

### Health Check Endpoint Implementation

[Source: architecture/high-level-architecture.md#architectural-patterns]

The `/api/health` endpoint should:

- Return 200 status with JSON: `{ status: 'healthy', timestamp: <unix-timestamp> }`
- Be stateless (no database checks for MVP)
- Use Next.js App Router route handler pattern in `apps/web/app/api/health/route.ts`

### GitHub Actions CI Configuration

**Required Workflow Steps:**

1. Checkout code
2. Setup Node.js 20
3. Install pnpm
4. Install dependencies (`pnpm install`)
5. Run linting (`pnpm lint`)
6. Run type-check (`pnpm type-check`)
7. Run tests (`pnpm test`) - will pass with placeholder tests

**Trigger:** On pull requests to `main` branch

### Vercel Deployment Configuration

**Build Settings:**

- Framework Preset: Next.js
- Root Directory: `apps/web`
- Build Command: `cd ../.. && pnpm install && pnpm --filter web build`
- Output Directory: (leave default, Next.js auto-detects)
- Install Command: `pnpm install`

**Environment Variables to Add in Vercel Dashboard:**

- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`

### Testing

[Source: architecture/testing-strategy.md]

**Testing Framework:** Vitest 1.2+ (TypeScript-native, fast)
**Component Testing:** React Testing Library 14+
**Coverage Target:** 70% for unit tests

**Test Organization:**

```
apps/web/tests/
├── unit/
│   ├── components/
│   ├── hooks/
│   └── services/
├── integration/
│   ├── api/
│   └── actions/
└── e2e/
    └── critical-paths.md  # Manual test scripts
```

**For This Story:**

- No specific unit tests required yet (infrastructure setup)
- Validation tests are manual: verify dev server runs, health check endpoint works, CI passes
- Testing infrastructure (Vitest setup) can be added in Story 1.2

**Testing Standards:**

- 70% unit tests (fast, isolated)
- 25% integration tests (API endpoints, database)
- 5% E2E tests (manual critical paths for MVP)

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-10-15 | 1.0     | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

claude-sonnet-4-5-20250929

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
